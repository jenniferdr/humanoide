\chapter{Experimentos y Resultados}\label{chapter:resultados}
En este capítulo se describen los experimentos realizados para analizar el desempeño del robot. Los experimentos se han dividido en tres partes. El primer conjunto de experimentos (sección \ref{sec:experimentosMov}) se ha realizado para verificar el desempeño y balance del robot al ejecutar uno o varios movimientos en secuencia (experimentos simples). El segundo y tercer conjunto de experimentos se bas\'o en verificar el desempeño del robot al buscar la pelota. En el segundo conjunto (sección \ref{sec:experimentosintegrados}) la forma de escoger la acciónes de movimiento han sido fijadas para cada región en la que se detecta la pelota. Mientras que para el tercer conjunto de experimentos (secci\'on \ref{sec:experimentosAprend}) la forma de escoger las acciones de movimiento ha sido resultado del aprendizaje por reforzamiento. Finalmente se describe los experimentos con el entrenamiento terminado y la orientaci\'on al arco (experimentos completos) en la secci\'on ~\ref{completos}. 

Algunos videos de los experimentos se encuentran disponibles en: \url { https://www.dropbox.com/sh/b1qxstva3o2hmu8/AAAbLx5ztJBwGylXtVWWbfJva?dl=0}
\section{Experimentos de Movimientos}\label{sec:experimentosMov}

Se realizaron una serie de experimentos para comprobar la movilidad del robot en cuanto a un conjunto de acciones de movimiento (mencionadas en la sección \ref{esqueleto}). Estas acciones son:
\begin{enumerate}

\setlength{\itemsep}{0.5pt}
\item Caminar un paso hacia adelante 
\item Caminar dos pasos hacia adelante 
\item Caminar cuatro pasos hacia adelante 
\item Girar hacia la derecha 
\item Girar doble a la derecha 
\item Girar hacia la izquierda 
\item Girar doble a la izquierda
\item Patada con la pierna derecha 
\item Patada con la pierna izquierda

\end{enumerate}
La primera etapa consistió en verificar el desempeño de las 9 unidades de acciones, para ello se procedió a realizar la ejecución de cada unidad 50 veces, 450 ejecuciones en total. Se tomó nota de las veces que lograba realizar el movimiento sin fallas, es decir, de forma exitosa y de aquellas que lograba completar el movimiento pero con fallas. Los resultados obtenidos fueron un 99.6\% de casos exitosos y un 0.4\% de casos en los que pudo recuperarse de fallas. El 0.4\% representa un solo caso en el que el robot se ha caído y levantado. Los resultados se muestran en el cuadro \ref{fig:individuales}.  

\begin{table}
\centering
\begin{tabular}{|c|c|c|c|c|}
\hline 
Movimiento & Cantidad de pruebas & Correctas & Fallidas & Con recuperaci\'on \\ 
\hline 
1 & 50 & 100\% & 0\% & NA \\ 
\hline 
2 & 50 & 98\% & 2\% & 0\% \\ 
\hline 
3 & 50 &  100\% & 0\% & NA \\ 
\hline 
4 & 50 &  100\% & 0\% & NA \\ 
\hline 
5 & 50 &  100\% & 0\% & NA \\ 
\hline 
6 & 50 &  100\% & 0\% & NA \\ 
\hline 
7 & 50 &  100\% & 0\% & NA \\ 
\hline 
8 & 50 &   98\% & 2\% & 2\% \\ 
\hline 
9 & 50 &  100\% & 0\% & NA \\ 
\hline 
\end{tabular} 
\caption{Resultados pruebas individuales de movimiento}
\label{fig:individuales}
\end{table}
Para la segunda etapa se evalu\'o la ejecuci\'on de combinaciones de una serie de unidades de movimiento. Las posibles combinaciones que se pueden generar con las acciones es $9 ^ 2$ por lo cual se consideró s\'olo un subconjunto de estas combinaciones, aquellas que el robot realiza con más frecuencia al caminar. Las combinaciones elegidas fueron: 

\begin{enumerate}
\setlength{\itemsep}{0.5pt}
\item Caminar hacia adelante y patear con la pierna derecha 
\item Caminar hacia adelante y patear con la pierna izquierda
\item Caminar hacia adelante, girar hacia la derecha y patear con la pierna derecha
\item Caminar hacia adelante, girar hacia la derecha, patear con la pierna izquierda 
\item Caminar hacia adelante, girar hacia la izquierda y patear con la derecha
\item Caminar hacia adelante, girar hacia la  izquierda y  patear con la pierna izquierda
\item Girar hacia la izquierda y patear con la pierna derecha
\item Girar hacia la derecha y patear con la izquierda
\item Girar hacia la derecha y patear con la pierna derecha
\item Girar hacia la izquierda y patear con la pierna izquierda

\end{enumerate}
Se realizaron 30 ejecuciones de cada una de estas combinaciones, 300 ejecuciones en total. El resultado ha sido satisfactorio, obteniendo un 99\% de casos exitosos y un 1\% de casos con fallas, de las que ha podido recuperarse. La mayoría de las fallas se presentaron cuando al patear se caía, sin embargo lograba recuperarse. Los resultados de estas pruebas se resumen en el cuadro ~\ref{fig:combinadas}.
 
\begin{table}
\centering
\begin{tabular}{|c|c|c|c|c|}
\hline 
Combinaci\'on & Cantidad de pruebas & Correctas & Fallidas & Con recuperaci\'on \\ 
\hline 
1 & 30 & 96.7\% & 3.3\% & 3.3\% \\ 
\hline 
2 & 30 & 100\% & 0\% & NA \\ 
\hline 
3 & 30 & 100\% & 0\% & NA \\ 
\hline 
4 & 30 & 100\% & 0\% & NA \\ 
\hline 
5 & 30 & 96.7\% & 3.3\% & 3.3\% \\ 
\hline 
6 & 30 & 100\% & 0\% & NA \\ 
\hline 
7 & 30 & 100\% & 0\% & NA \\ 
\hline 
8 & 30 & 100\% & 0\% & NA \\ 
\hline 
9 & 30 & 100\% & 0\% & NA \\ 
\hline 
10 & 30 & 100\% & 0\% & NA \\ 
\hline 
\end{tabular} 
\caption{Resultados de los experimentos con las acciones combinadas elegidas}
\label{fig:combinadas}
\end{table}

%\begin{figure}[th!]
%\begin{tikzpicture}
%\pie[pos={10 ,0}, radius =2, explode =0.3, text = legend, rotate =180]{96/Exitosas, 4/Con fallas corregidas}
%\end{tikzpicture}
%\caption{Segunda etapa: 300 ejecuciones de acciones combinadas}
%\label{fig:etp2}
%\end{figure}
Para determinar la precisi\'on y desempe\~no de la detecc\'ion de la pelota se realizaron experimentos de enfoque r\'apido los cuales consistieron en la colocaci\'on de la pelota a una distancia fija, mover la c\'amara rapidamente y regresar a la posici\'on y observar si ubicaba la pelota correctamente, las distancias utilizadas fueron 50cm y 80cm del robot. Adem\'as para determinar posibles Falsos Positivos, es decir, detectar una pelota inexistente, se realiz\'o el mismo experimento pero sin la pelota. Los resultados obtenidos se presentan en el cuadro ~\ref{fig:deteccion}.

\begin{table}
\centering
\begin{tabular}{|c|c|c|}
 \hline 
  & Cantidad de Pruebas & Correctas \\ 
 \hline 
 A 50cm & 50 & 100\% \\ 
 \hline 
 A 80 cm & 50 & 100\% \\ 
 \hline 
 No pelota & 50 & 100\% \\ 
  \hline 

 \end{tabular}  
\caption{Resultados de las pruebas de detecci\'on}
\label{fig:deteccion} 

\end{table}

\section{Experimentos con Comportamientos Integrados}
\label{sec:experimentosintegrados}

El segundo conjunto de experimentos consistió en la realización de pruebas de desempeño en donde se observó el comportamiento global del robot con todos sus comportamientos integrados (detección, búsqueda y pateo). La forma de elegir la acciones de movimiento es la que se describe en la sección \ref{eleccionAccionesFijas} (sin aprendizaje). 

El  primer caso (CasoI) consistió en la colocación de la pelota en la zona de pateo (las regiones 1 y 2 de la figura ~\ref{divisionCam}). El número de pruebas en este primer caso fue de 10, con una duración aproximada de 30 segundos cada una.

%\begin{figure}
%\begin{tikzpicture}
%\pie[pos={10 ,0}, radius =2, explode =0.3, text = legend, rotate =180]{90/Pateó, 10/Falló}
%\end{tikzpicture}
%\caption{Pruebas de movimientos integrados CASO I}
%\label{fig:caso1}
%\end{figure}

El segundo caso (CasoII) consistió en en la colocación inicial de la pelota a una distancia de 50 cm en línea recta al robot. Se realizaron 50 pruebas, siendo la duración promedio de 2 minutos con 12 segundos.

%\begin{figure}
%\begin{tikzpicture}
%\pie[pos={10 ,0}, radius =2, explode =0.3, text = legend, rotate =180]{70/Exitosas, 10/Con fallas corregidas, 20/Fallidas}
%\end{tikzpicture}
%\caption{Pruebas de movimientos integrados CASO II}
%\label{fig:caso2}
%\end{figure}

El tercer caso  (CasoIII) consistió en en la colocación inicial de la pelota a una distancia de 50 cm en línea recta al robot y 50 cm a la izquierda formando asi una diagonal. Se realizaron 10 pruebas, siendo la duración promedio de 3 minutos con 29 segundos. 

%\begin{figure}
%\begin{tikzpicture}
%\pie[pos={10 ,0}, radius =2, explode =0.3, text = legend, rotate =180]{80/Exitosas, 20/Fallidas}
%\end{tikzpicture}
%\caption{Pruebas de movimientos integrados CASO III}
%\label{fig:caso3}
%\end{figure}

El cuarto caso (Caso IV) consistió en en la colocación inicial de la pelota a una distancia de 50 cm en línea recta al robot y 50 cm a la derecha. Se realizaron 10 pruebas, siendo la duración promedio de 4 minutos con 48 segundos. 

%\begin{figure}
%\begin{tikzpicture}
%\pie[pos={10 ,0}, radius =2, explode =0.3, text = legend, rotate =180]{90/Exitosas, 10/Fallidas}
%\end{tikzpicture}
%\caption{Pruebas de movimientos integrados CASO IV}
%\label{fig:caso4}
%\end{figure} 
\begin{table}
\centering

\begin{tabular}{|p{3cm}|p{2cm}|c|p{2cm}|c|p{2cm}|}
\hline 
& Cantidad de 
pruebas realizadas & Correctas & Con fallas recuperadas & Fallidas & Tiempo Promedio \\ 
%\hline 
%Subconjunto de combinadas & 300 & 96\% & 4\% & NA & NA \\ 
\hline 
Caso I & 10 & 90\% & 10\% & 0\% & 30 s \\ 
\hline 
Caso II & 10 & 70\% & 10\% & 20\% & 2m 12s \\ 
\hline 
Caso III & 10 & 80\% & 0\% & 20\% & 3m 29s \\ 
\hline 
Caso IV & 10 & 90\% & 0\% & 10\% & 4m 48s \\ 
\hline 
\end{tabular} 

\caption{Resultados de los casos I, II, III, IV descritos en la secci\'on de \ref{sec:experimentosintegrados}}
\label{fig:casos}

\end{table}

Los resultados de los casos del I al IV se pueden observar en el cuadro ~\ref{fig:casos}. Con un total de 40 pruebas de comportamiento integrado, los resultados obtenidos han sido satifactorios con un porcentaje de logro del 82\% más un 5.5\% en el cual se logró recuperar y finalizar la tarea, esto a pesar del 12.5\% de fallas que se produjo durante la tarea. %se pudo observar de manera general que la razón de dichas fallas ha sido ocasionada por problemas de batería.



\section{Experimentos con Aprendizaje}\label{sec:experimentosAprend}

Finalmente, el tercer conjunto de experimentos consistió en verificar los resultados de la aplicaci\'on del apredizaje por reforzamiento para la búsqueda de la pelota. Estos resultados se presentan a continuaci\'on.

Dentro de las fórmulas para el aprendizaje-Q se encuentran dos constantes que han sido configuradas de diferentes maneras para analizar cuál de las combinaciones brinda mejores resultados. Las constantes son la tasa de descuento $\gamma$ de la fórmula del aprendizaje-Q y la constante $K$, de la fórmula de probabilidad explicada en la secci\'on \ref{subsec:eleccionAccion}, que ajusta la distribución de probabilidad que se le da a una acción dependiendo de su valor $Q(s,a)$. Se utilizaron las siguientes combinaciones para las constantes:

\begin{itemize}
 \setlength\itemsep{0.3pt}
\item $K$ = 1 , $\gamma$ = 0.1
\item $K$ = 2 , $\gamma$ = 0.1 
\item $K$ = 2 , $\gamma$ = 0.7
\item $K$ = 3 , $\gamma$ = 0.1
\item $K$ = 3 , $\gamma$ = 0.7
\item $K$ = 5 , $\gamma$ = 0.1
\item $K$ = 5 , $\gamma$ = 0.7
   
\end{itemize}

Una prueba completa o prueba de comportamiento integrado se define como la colocaci\'on del robot y la pelota en posiciones iniciales arbitrarias, entonces el robot debe ser capaz de detectar la pelota, trasladarse hacia ella y patearla. Las pruebas se realizaron en un espacio de $1.8 m \times 1.6 m$
en donde se aseguraba que el color particular de la pelota no se repitiera, de ser así esa prueba se consideraba inválida.

Cada una de estas combinaciones se entrenó con 20 ejecuciones completas. Con los valores $Q(s,a)$ para cada estado y acción inicializados en cero (0), exceptuando los estados de la zona de pateo, que han sido inicializados con el valor 1. Una vez completados los entrenamientos se realizó un conjunto de pruebas para medir el desempeño del resultado de cada combinación y reconocer la mejor usando el porcentaje de pateos efectivos. Se realizó una prueba, de 10 ejecuciones cada una, para cada combinación. En total se realizaron 210 ejecuciones. La elecci\'on de s\'olo 20 pruebas para el conjunto de entrenamiento se deb\'io a que los motores son delicados, por lo cual mientras se aumentaba el n\'umero de pruebas aumentaba el riesgo de quemarlos.

Para la combinaci\'on de $K = 1$ y $ \gamma = 0.1 $ los resultados obtenidos se presentan en el cuadro ~\ref{tabla:entramientos}. Cuando $K = 1$ la probabilidad de elegir la acci\'on, dado un estado, es igual para todas las acciones, por lo tanto la elección de la acción para este caso ha sido uniformemente aleatoria. Los resultados de las combinaciones de par\'ametros ajustables se presentan en el cuadro ~\ref{tabla:entramientos}.
\begin{table}
\centering
\begin{tabular}{|c|c|c|c|}
\hline 
& Cantidad & Correctas & Fallidas \\ 
\hline 
$K = 1  \gamma = 0.1$ & 20 & 80\% & 20\% \\ 
\hline 
$K = 2  \gamma = 0.1$ & 20 & 80\% & 20\% \\ 
\hline 
$K = 2  \gamma = 0.7$ & 20 & 60\% & 40\% \\ 
\hline 
$K = 3  \gamma = 0.1$ & 20 & 90\% & 10\% \\ 
\hline 
$K = 3  \gamma = 0.7$ & 20 & 80\% & 20\% \\ 
\hline 
$K = 5  \gamma = 0.1$ & 20 & 80\% & 20\% \\ 
\hline  
$K = 5  \gamma = 0.7$ & 20 & 70\% & 30\% \\ 
\hline 

\end{tabular} 

\caption{Resultados de los distintos par\'ametros con aprendizaje}
\label{tabla:entramientos}


\end{table}
%
%\begin{figure}
%\begin{tikzpicture}
%\pie[pos={10 ,0}, radius =2, explode =0.3, text = legend, rotate =180]{80/Exitosas, 20/Fallidas}
%\end{tikzpicture}
%\caption{Prueba con  $K = 1$ y $ \gamma = 0.1 $}
%\label{fig:k1y1}
%\end{figure} 
%
%\begin{figure}[h]
%\begin{tikzpicture}
%\pie[pos={10 ,0}, radius =2, explode =0.3, text = legend, rotate =180]{80/Exitosas, 20/Fallidas}
%\end{tikzpicture}
%\caption{Prueba con $K = 2$ y $ \gamma = 0.1 $}
%\label{fig:k2y1}
%\end{figure} 
%
%\begin{figure}[h]
%\begin{tikzpicture}
%\pie[pos={10 ,0}, radius =2, explode =0.3, text = legend, rotate =180]{60/Exitosas, 40/Fallidas}
%\end{tikzpicture}
%\caption{Prueba  con $K = 2$ y $ \gamma = 0.7 $}
%\label{fig:k2y7}
%\end{figure} 
%
%\begin{figure}[h]
%\begin{tikzpicture}
%\pie[pos={10 ,0}, radius =2, explode =0.3, text = legend, rotate =180]{90/Exitosas, 10/Fallidas}
%\end{tikzpicture}
%\caption{Prueba con $K = 3$ y $ \gamma = 0.1 $}
%\label{fig:k3y1}
%\end{figure} 
%
%\begin{figure}[h]
%\begin{tikzpicture}
%\pie[pos={10 ,0}, radius =2, explode =0.3, text = legend, rotate =180]{80/Exitosas, 20/Fallidas}
%\end{tikzpicture}
%\caption{Prueba con $K = 3$ y $ \gamma = 0.7 $}
%\label{fig:k3y7}
%\end{figure} 
%
%\begin{figure}[h]
%\begin{tikzpicture}
%\pie[pos={10 ,0}, radius =2, explode =0.3, text = legend, rotate =180]{80/Exitosas, 20/Fallidas}
%\end{tikzpicture}
%\caption{Prueba con $K = 5$ y $ \gamma = 0.1 $}
%\label{fig:k5y1}
%\end{figure} 
%
%\begin{figure}[h]
%\begin{tikzpicture}
%\pie[pos={10 ,0}, radius =2, explode =0.3, text = legend, rotate =180]{70/Exitosas, 30/Fallidas}
%\end{tikzpicture}
%\caption{Prueba con $K = 5$ y $ \gamma = 0.7 $}
%\label{fig:k5y7}
%\end{figure} 

Los resultados de los entrenamientos arrojaron que la mejor combinaci\'on fue $K = 3$ y $ \gamma = 0.1 $ que obtuvo un desempeño favorable del 90\% de las pruebas realizadas.

Con el objetivo de lograr un mejor desempeño de Junny, se inicializ\'o los valores de $Q(s,a)$ con valores de recompesas negativas para aquellas acciones cuyos efectos, en un estado particular, serían obviamente err\'oneos. Con esto se ayuda al aprendizaje del robot, disminuyendo la probabilidad de tomar acciones ineficientes. Adem\'as se aumentó el n\'umero de pruebas de entrenamiento a 30 con el mismo objetivo.

Para medir el desempeño general de Junny, con respecto al último entrenamiento, se realizó una prueba de 15 ejecuciones colocando la pelota a distintas distancias. Los resultados de esta \'ultima prueba  son de 100\% de éxitos con $K = 3$ y $ \gamma = 0.1 $ e inicializaci\'on de Q(s,a). %se presenta en el gr\'afico \ref{fig:mejor}. 
%
%\begin{figure}[h]
%\begin{tikzpicture}
%\pie[pos={10 ,0}, radius =2, explode =0.3, text = legend, rotate =180]{100/Exitosas, 0/Fallidas}
%\end{tikzpicture}
%\caption{Prueba con $K = 3$ y $ \gamma = 0.1 $ e inicializaci\'on de Q(s,a)}
%\label{fig:mejor}
%\end{figure} 

Para un análisis más profundo de los resultados, se estableci\'o el n\'umero estimado de acciones esperadas, dado un estado inicial, que debe realizar el robot para llegar hasta la pelota. Con esto se puede tener una referencia de cuantas acciones debió realizar Junny en cada ejecución y comparar con el número de acciones que realmente tomó. La manera de calcular la eficiencia ha sido dividiendo la cantidad de acciones esperadas entre la cantidad de acciones realizadas. Por lo tanto mientras mas cercano a uno (1) se considera una mejor tasa de eficiencia. Para valores mayores a uno (1) significa que se realizaron menos acciones de lo esperado. Esto es posible ya que el número de acciones esperadas se calcula en base al peor de los casos.  

Para la última prueba se obtuvo una eficiencia de $0.72$. Sin embargo bajo los mismos parametros de $K = 3$ y $ \gamma = 0.1 $ con el resultado del entrenamiento con 20 pruebas (y valores de $Q(s,a)$ inicializados en cero) se obtuvo una eficiencia de $0.64$. Por lo tanto con el aumento de 10 pruebas de entrenamiento e inicialización de los valores $Q(s,a)$ se mejoró aproximadamente un 12\%. Este es un indicativo de que con mayor cantidad de pruebas este porcentaje mejorar\'a y la eficiencia aumentará.

%Así mismo al comparar los tiempos promedios, con respecto a la última prueba, se obtienen los siguientes resultados. El tiempo promedio de las pruebas cuyas acciones esperadas eran menor a 8 (estados mas cercanos) fue de 4m y 19s en contraste con el promedio del tiempo de las pruebas cuyas acciones esperadas eran mayores a 8 que fue 3m y 21s.

Se realiz\'o un experimento comparativo para observar el desempe\~no del comportamiento sin aprendizaje y con aprendizaje, por ello, se hizo el mismo experimento de los casos II, III, IV (explicados en la sección anterior) pero con el comportamiento generado después del entrenamiento con la combinación $K = 3 $ y $ \gamma = 0.1$. Los resultados obtenidos fueron un mayor porcentaje de aciertos para el aprendizaje pero a un costo de tiempo que se puede observar en el cuadro ~\ref{tabla:comparacion}, cada prueba en ambos casos ejecut\'o 10 veces.

\begin{table}
\centering
\begin{tabular}{|c|c|c|c|}
\hline  & Caso II & Caso III & Caso IV \\ 
\hline 
Correctas con aprendizaje & 100\% & 100\% & 100\% \\ 
\hline 
Correctas sin aprendizaje & 70\% & 80\% & 90\% \\ 
\hline 
Fallidas con aprendizaje & 0\% & 0\% & 0\% \\ 
\hline 
Fallidas sin aprendizaje & 20\% & 20\% & 10\% \\ 
\hline 
Recuperadas con aprendizaje & NA & NA & NA \\ 
\hline 
Recuperadas sin aprendizaje & 10\% & 0\% & 0\% \\ 
\hline 
Tiempo promedio con aprendizaje & 2m 35 s & 5m 38s & 4m 14s \\ 
\hline 
Tiempo promedio sin aprendizaje & 2m 12s & 3m 29 s & 4m 48s \\
\hline
%\caption{Cada prueba tiene un numero de corridas de 10}
\end{tabular} 
\caption{Comparaci\'on de movimientos predeterminados y aprendizaje}
\label{tabla:comparacion}

\end{table}

 Un resultado a destacar es que el tiempo promedio de pruebas a la derecha (Caso IV) es en proporci\'on  menor a las pruebas a la izquierda (Caso III) a pesar que las mismas son sim\'etricas. Esto indica que los siguientes entrenamientos deben hacer \'enfasis en los estados a la izquierda del robot.
 
\section{Experimentos completos} \label{completos}

Finalmente se realizaron experimentos con aprendizaje y patada con orientaci\'on, basicamente el robot part\'ia de un punto fijo y la pelota era colocada arbitrareamente en el campo de entrenamiento, el deb\'ia llegar a la pelota, ubicar el arco, posicionarse con respecto al arco y la pelota para realizar un pateo y meter gol.
Las m\'etricas usadas fueron el pateo hacia el arco que generaba un gol y el que pateaba pero no lograba entrar el bal\'on. Estos resultados se muestran en la figura \ref{fig:orientacion}.


\begin{figure}[h]
\centering
\begin{tikzpicture}
\pie[pos={10 ,0}, radius =1.5, explode =0.3, text = legend, rotate =180]{53.33/Goles, 6.666/TiroAlArco , 40/Fallos}
\end{tikzpicture}
\caption{Prueba con 15 ejecuciones, con aprendizaje y orientaci\'on al arco }
\label{fig:orientacion}
\end{figure} 

